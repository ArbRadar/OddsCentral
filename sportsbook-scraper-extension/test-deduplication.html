<!DOCTYPE html>
<html>
<head>
    <title>Test Deduplication Logic</title>
</head>
<body>
    <h1>Testing Data Deduplication</h1>
    <div id="results"></div>
    
    <script>
        // Test the deduplication logic
        const testGames = [
            {game_id: "game1", created_at: "2025-08-25T01:00:00Z", home_team: "Team A"},
            {game_id: "game1", created_at: "2025-08-25T02:00:00Z", home_team: "Team A"}, // Latest
            {game_id: "game2", created_at: "2025-08-25T01:30:00Z", home_team: "Team B"},
            {game_id: "game1", created_at: "2025-08-25T01:30:00Z", home_team: "Team A"}, // Older
        ];
        
        const testOdds = [
            {game_id: "game1", sportsbook: "Book A", created_at: "2025-08-25T01:00:00Z", home_odds: -110},
            {game_id: "game1", sportsbook: "Book A", created_at: "2025-08-25T02:00:00Z", home_odds: -120}, // Latest
            {game_id: "game1", sportsbook: "Book B", created_at: "2025-08-25T01:00:00Z", home_odds: +100},
            {game_id: "game2", sportsbook: "Book A", created_at: "2025-08-25T01:30:00Z", home_odds: -105},
        ];
        
        // Deduplicate games
        const latestGamesMap = new Map();
        testGames.forEach(game => {
            if (!latestGamesMap.has(game.game_id) || new Date(game.created_at) > new Date(latestGamesMap.get(game.game_id).created_at)) {
                latestGamesMap.set(game.game_id, game);
            }
        });
        const deduplicatedGames = Array.from(latestGamesMap.values());
        
        // Deduplicate odds
        const latestOddsMap = new Map();
        testOdds.forEach(odds => {
            const key = `${odds.game_id}-${odds.sportsbook}`;
            if (!latestOddsMap.has(key) || new Date(odds.created_at) > new Date(latestOddsMap.get(key).created_at)) {
                latestOddsMap.set(key, odds);
            }
        });
        const deduplicatedOdds = Array.from(latestOddsMap.values());
        
        document.getElementById('results').innerHTML = `
            <h2>Test Results</h2>
            <p>Original games: ${testGames.length} → Deduplicated: ${deduplicatedGames.length}</p>
            <p>Original odds: ${testOdds.length} → Deduplicated: ${deduplicatedOdds.length}</p>
            
            <h3>Deduplicated Games:</h3>
            <pre>${JSON.stringify(deduplicatedGames, null, 2)}</pre>
            
            <h3>Deduplicated Odds:</h3>
            <pre>${JSON.stringify(deduplicatedOdds, null, 2)}</pre>
        `;
    </script>
</body>
</html>